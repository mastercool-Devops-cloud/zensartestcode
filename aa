import static org.mockito.Mockito.*;

import jakarta.servlet.FilterChain;
import jakarta.servlet.ServletRequest;
import jakarta.servlet.ServletResponse;
import jakarta.servlet.http.HttpServletRequest;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.ExtendWith;
import org.mockito.InjectMocks;
import org.mockito.Mock;
import org.mockito.Mockito;
import org.mockito.junit.jupiter.MockitoExtension;
import java.io.IOException;
import java.util.HashMap;
import java.util.Map;

@ExtendWith(MockitoExtension.class)
class RequestLogFilterTest {
    
    @Mock
    private HttpServletRequest httpServletRequest;
    
    @Mock
    private ServletResponse servletResponse;
    
    @Mock
    private FilterChain filterChain;
    
    @Mock
    private CachedBodyHttpServletRequestWrapper wrappedRequest;
    
    @Mock
    private BaseLogDetails baseLogDetails;
    
    private RequestLogFilter requestLogFilter;
    
    private final String applicationName = "TestApp";
    private final String environment = "TestEnv";
    
    @BeforeEach
    void setUp() {
        requestLogFilter = new RequestLogFilter(applicationName, environment);
    }
    
    @Test
    void testDoFilter_Success() throws Exception {
        when(httpServletRequest.getMethod()).thenReturn("POST");
        when(httpServletRequest.getRequestURI()).thenReturn("/test");
        when(httpServletRequest.getHeader("Content-Length")).thenReturn("100");
        when(httpServletRequest.getHeader("Host")).thenReturn("localhost");
        when(httpServletRequest.getContentType()).thenReturn("application/json");
        when(httpServletRequest.getHeader("User-Agent")).thenReturn("JUnit-Test");
        when(httpServletRequest.getHeader("Accept")).thenReturn("application/json");
        
        requestLogFilter.doFilter(httpServletRequest, servletResponse, filterChain);
        
        verify(filterChain, times(1)).doFilter(Mockito.any(), Mockito.eq(servletResponse));
    }
    
    @Test
    void testDoFilter_ExceptionHandling() throws Exception {
        when(httpServletRequest.getMethod()).thenReturn("POST");
        when(httpServletRequest.getRequestURI()).thenReturn("/test");
        
        doThrow(new IOException("Test Exception")).when(filterChain).doFilter(any(ServletRequest.class), any(ServletResponse.class));
        
        try {
            requestLogFilter.doFilter(httpServletRequest, servletResponse, filterChain);
        } catch (IOException e) {
            verify(filterChain, times(1)).doFilter(Mockito.any(), Mockito.eq(servletResponse));
        }
    }
    
    @Test
    void testGetHttpRequestMetaData() {
        when(httpServletRequest.getHeader("Content-Length")).thenReturn("100");
        when(httpServletRequest.getHeader("Host")).thenReturn("localhost");
        when(httpServletRequest.getContentType()).thenReturn("application/json");
        when(httpServletRequest.getHeader("User-Agent")).thenReturn("JUnit-Test");
        when(httpServletRequest.getHeader("Accept")).thenReturn("application/json");
        
        requestLogFilter.getHttpRequestMetaData(httpServletRequest);
        
        Map<String, String> expectedMetadata = new HashMap<>();
        expectedMetadata.put("environment", environment);
        expectedMetadata.put("content-length", "100");
        expectedMetadata.put("host", "localhost");
        expectedMetadata.put("content-type", "application/json");
        expectedMetadata.put("user-agent", "JUnit-Test");
        expectedMetadata.put("accept", "application/json");
        
        assert requestLogFilter.metadata.equals(expectedMetadata);
    }
}
---------------------------------------
13:43:33.281 [main] ERROR com.sb.fedssimplification.utilitymodules.loggingutility.logprocessor.LogProcessorFactory -- Error Log: {
  "baseLogDetails" : null,
  "errorCode" : 500,
  "stackTrace" : "[com.sb.fedssimplification.utilitymodules.loggingutility.util.IpAddressUtil.getClientIpAddress(IpAddressUtil.java:23), com.sb.fedssimplification.utilitymodules.loggingutility.filter.RequestLogFilter.getHttpRequestMetaData(RequestLogFilter.java:75), com.sb.fedssimplification.utilitymodules.loggingutility.filter.RequestLogFilter.doFilter(RequestLogFilter.java:46), com.sb.fedssimplification.utilitymodules.secretsmanager.filter.RequestLogFilterTest.testDoFilter_Success(RequestLogFilterTest.java:61), java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103), java.base/java.lang.reflect.Method.invoke(Method.java:580), org.junit.platform.commons.util.ReflectionUtils.invokeMethod(ReflectionUtils.java:728), org.junit.jupiter.engine.execution.MethodInvocation.proceed(MethodInvocation.java:60), org.junit.jupiter.engine.execution.InvocationInterceptorChain$ValidatingInvocation.proceed(InvocationInterceptorChain.java:131), org.junit.jupiter.engine.extension.TimeoutExtension.intercept(TimeoutExtension.java:156), org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestableMethod(TimeoutExtension.java:147), org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestMethod(TimeoutExtension.java:86), org.junit.jupiter.engine.execution.InterceptingExecutableInvoker$ReflectiveInterceptorCall.lambda$ofVoidMethod$0(InterceptingExecutableInvoker.java:103), org.junit.jupiter.engine.execution.InterceptingExecutableInvoker.lambda$invoke$0(InterceptingExecutableInvoker.java:93), org.junit.jupiter.engine.execution.InvocationInterceptorChain$InterceptedInvocation.proceed(InvocationInterceptorChain.java:106), org.junit.jupiter.engine.execution.InvocationInterceptorChain.proceed(InvocationInterceptorChain.java:64), org.junit.jupiter.engine.execution.InvocationInterceptorChain.chainAndInvoke(InvocationInterceptorChain.java:45), org.junit.jupiter.engine.execution.InvocationInterceptorChain.invoke(InvocationInterceptorChain.java:37), org.junit.jupiter.engine.execution.InterceptingExecutableInvoker.invoke(InterceptingExecutableInvoker.java:92), org.junit.jupiter.engine.execution.InterceptingExecutableInvoker.invoke(InterceptingExecutableInvoker.java:86), org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.lambda$invokeTestMethod$7(TestMethodTestDescriptor.java:217), org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73), org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.invokeTestMethod(TestMethodTestDescriptor.java:213), org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:138), org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:68), org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:151), org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73), org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141), org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137), org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139), org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73), org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138), org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95), java.base/java.util.ArrayList.forEach(ArrayList.java:1596), org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41), org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155), org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73), org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141), org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137), org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139), org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73), org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138), org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95), java.base/java.util.ArrayList.forEach(ArrayList.java:1596), org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41), org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155), org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73), org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141), org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137), org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139), org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73), org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138), org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95), org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.submit(SameThreadHierarchicalTestExecutorService.java:35), org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor.execute(HierarchicalTestExecutor.java:57), org.junit.platform.engine.support.hierarchical.HierarchicalTestEngine.execute(HierarchicalTestEngine.java:54), org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:198), org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:169), org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:93), org.junit.platform.launcher.core.EngineExecutionOrchestrator.lambda$execute$0(EngineExecutionOrchestrator.java:58), org.junit.platform.launcher.core.EngineExecutionOrchestrator.withInterceptedStreams(EngineExecutionOrchestrator.java:141), org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:57), org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:103), org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:85), org.junit.platform.launcher.core.DelegatingLauncher.execute(DelegatingLauncher.java:47), org.junit.platform.launcher.core.SessionPerRequestLauncher.execute(SessionPerRequestLauncher.java:63), com.intellij.junit5.JUnit5IdeaTestRunner.startRunnerWithArgs(JUnit5IdeaTestRunner.java:57), com.intellij.rt.junit.IdeaTestRunner$Repeater$1.execute(IdeaTestRunner.java:38), com.intellij.rt.execution.junit.TestsRepeater.repeat(TestsRepeater.java:11), com.intellij.rt.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:35), com.intellij.rt.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:232), com.intellij.rt.junit.JUnitStarter.main(JUnitStarter.java:55)]",
  "errorMessage" : "\nStrict stubbing argument mismatch. Please check:\n - this invocation of 'getHeader' method:\n    httpServletRequest.getHeader(\n    \"X-Forwarded-For\"\n);\n    -> at com.sb.fedssimplification.utilitymodules.loggingutility.util.IpAddressUtil.getClientIpAddress(IpAddressUtil.java:23)\n - has following stubbing(s) with different arguments:\n    1. httpServletRequest.getHeader(\"Host\");\n      -> at com.sb.fedssimplification.utilitymodules.secretsmanager.filter.RequestLogFilterTest.testDoFilter_Success(RequestLogFilterTest.java:56)\n    2. httpServletRequest.getHeader(\"User-Agent\");\n      -> at com.sb.fedssimplification.utilitymodules.secretsmanager.filter.RequestLogFilterTest.testDoFilter_Success(RequestLogFilterTest.java:58)\n    3. httpServletRequest.getHeader(\"Accept\");\n      -> at com.sb.fedssimplification.utilitymodules.secretsmanager.filter.RequestLogFilterTest.testDoFilter_Success(RequestLogFilterTest.java:59)\nTypically, stubbing argument mismatch indicates user mistake when writing tests.\nMockito fails early so that you can debug potential problem easily.\nHowever, there are legit scenarios when this exception generates false negative signal:\n  - stubbing the same method multiple times using 'given().will()' or 'when().then()' API\n    Please use 'will().given()' or 'doReturn().when()' API for stubbing.\n  - stubbed method is intentionally invoked with different arguments by code under test\n    Please use default or 'silent' JUnit Rule (equivalent of Strictness.LENIENT).\nFor more information see javadoc for PotentialStubbingProblem class."
}

org.mockito.exceptions.misusing.PotentialStubbingProblem: 
Strict stubbing argument mismatch. Please check:
 - this invocation of 'getHeader' method:
    httpServletRequest.getHeader(
    "X-Forwarded-For"
);
    -> at com.sb.fedssimplification.utilitymodules.loggingutility.util.IpAddressUtil.getClientIpAddress(IpAddressUtil.java:23)
 - has following stubbing(s) with different arguments:
    1. httpServletRequest.getHeader("Host");
      -> at com.sb.fedssimplification.utilitymodules.secretsmanager.filter.RequestLogFilterTest.testDoFilter_Success(RequestLogFilterTest.java:56)
    2. httpServletRequest.getHeader("User-Agent");
      -> at com.sb.fedssimplification.utilitymodules.secretsmanager.filter.RequestLogFilterTest.testDoFilter_Success(RequestLogFilterTest.java:58)
    3. httpServletRequest.getHeader("Accept");
      -> at com.sb.fedssimplification.utilitymodules.secretsmanager.filter.RequestLogFilterTest.testDoFilter_Success(RequestLogFilterTest.java:59)
Typically, stubbing argument mismatch indicates user mistake when writing tests.
Mockito fails early so that you can debug potential problem easily.
However, there are legit scenarios when this exception generates false negative signal:
  - stubbing the same method multiple times using 'given().will()' or 'when().then()' API
    Please use 'will().given()' or 'doReturn().when()' API for stubbing.
  - stubbed method is intentionally invoked with different arguments by code under test
    Please use default or 'silent' JUnit Rule (equivalent of Strictness.LENIENT).
For more information see javadoc for PotentialStubbingProblem class.

	at com.sb.fedssimplification.utilitymodules.loggingutility.util.IpAddressUtil.getClientIpAddress(IpAddressUtil.java:23)
	at com.sb.fedssimplification.utilitymodules.loggingutility.filter.RequestLogFilter.getHttpRequestMetaData(RequestLogFilter.java:75)
	at com.sb.fedssimplification.utilitymodules.loggingutility.filter.RequestLogFilter.doFilter(RequestLogFilter.java:46)
	at com.sb.fedssimplification.utilitymodules.secretsmanager.filter.RequestLogFilterTest.testDoFilter_Success(RequestLogFilterTest.java:61)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1596)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1596)
-----------------------------------
@Test
void testDoFilter_Success() throws Exception {
    when(httpServletRequest.getMethod()).thenReturn("POST");
    when(httpServletRequest.getRequestURI()).thenReturn("/test");
    when(httpServletRequest.getHeader("Content-Length")).thenReturn("100");
    when(httpServletRequest.getHeader("Host")).thenReturn("localhost");
    when(httpServletRequest.getContentType()).thenReturn("application/json");
    when(httpServletRequest.getHeader("User-Agent")).thenReturn("JUnit-Test");
    when(httpServletRequest.getHeader("Accept")).thenReturn("application/json");
    when(httpServletRequest.getHeader("X-Forwarded-For")).thenReturn("192.168.1.1"); // <-- Add this line
    
    requestLogFilter.doFilter(httpServletRequest, servletResponse, filterChain);
    
    verify(filterChain, times(1)).doFilter(Mockito.any(), Mockito.eq(servletResponse));
}
13:47:37.224 [main] ERROR com.sb.fedssimplification.utilitymodules.loggingutility.logprocessor.LogProcessorFactory -- Error Log: {
  "baseLogDetails" : null,
  "errorCode" : 500,
  "stackTrace" : "[com.sb.fedssimplification.utilitymodules.loggingutility.model.request.CachedBodyHttpServletRequestWrapper.<init>(CachedBodyHttpServletRequestWrapper.java:15), com.sb.fedssimplification.utilitymodules.loggingutility.filter.RequestLogFilter.doFilter(RequestLogFilter.java:48), com.sb.fedssimplification.utilitymodules.secretsmanager.filter.RequestLogFilterTest.testDoFilter_Success(RequestLogFilterTest.java:62), java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103), java.base/java.lang.reflect.Method.invoke(Method.java:580), org.junit.platform.commons.util.ReflectionUtils.invokeMethod(ReflectionUtils.java:728), org.junit.jupiter.engine.execution.MethodInvocation.proceed(MethodInvocation.java:60), org.junit.jupiter.engine.execution.InvocationInterceptorChain$ValidatingInvocation.proceed(InvocationInterceptorChain.java:131), org.junit.jupiter.engine.extension.TimeoutExtension.intercept(TimeoutExtension.java:156), org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestableMethod(TimeoutExtension.java:147), org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestMethod(TimeoutExtension.java:86), org.junit.jupiter.engine.execution.InterceptingExecutableInvoker$ReflectiveInterceptorCall.lambda$ofVoidMethod$0(InterceptingExecutableInvoker.java:103), org.junit.jupiter.engine.execution.InterceptingExecutableInvoker.lambda$invoke$0(InterceptingExecutableInvoker.java:93), org.junit.jupiter.engine.execution.InvocationInterceptorChain$InterceptedInvocation.proceed(InvocationInterceptorChain.java:106), org.junit.jupiter.engine.execution.InvocationInterceptorChain.proceed(InvocationInterceptorChain.java:64), org.junit.jupiter.engine.execution.InvocationInterceptorChain.chainAndInvoke(InvocationInterceptorChain.java:45), org.junit.jupiter.engine.execution.InvocationInterceptorChain.invoke(InvocationInterceptorChain.java:37), org.junit.jupiter.engine.execution.InterceptingExecutableInvoker.invoke(InterceptingExecutableInvoker.java:92), org.junit.jupiter.engine.execution.InterceptingExecutableInvoker.invoke(InterceptingExecutableInvoker.java:86), org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.lambda$invokeTestMethod$7(TestMethodTestDescriptor.java:217), org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73), org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.invokeTestMethod(TestMethodTestDescriptor.java:213), org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:138), org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:68), org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:151), org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73), org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141), org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137), org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139), org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73), org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138), org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95), java.base/java.util.ArrayList.forEach(ArrayList.java:1596), org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41), org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155), org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73), org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141), org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137), org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139), org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73), org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138), org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95), java.base/java.util.ArrayList.forEach(ArrayList.java:1596), org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41), org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155), org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73), org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141), org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137), org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139), org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73), org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138), org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95), org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.submit(SameThreadHierarchicalTestExecutorService.java:35), org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor.execute(HierarchicalTestExecutor.java:57), org.junit.platform.engine.support.hierarchical.HierarchicalTestEngine.execute(HierarchicalTestEngine.java:54), org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:198), org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:169), org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:93), org.junit.platform.launcher.core.EngineExecutionOrchestrator.lambda$execute$0(EngineExecutionOrchestrator.java:58), org.junit.platform.launcher.core.EngineExecutionOrchestrator.withInterceptedStreams(EngineExecutionOrchestrator.java:141), org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:57), org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:103), org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:85), org.junit.platform.launcher.core.DelegatingLauncher.execute(DelegatingLauncher.java:47), org.junit.platform.launcher.core.SessionPerRequestLauncher.execute(SessionPerRequestLauncher.java:63), com.intellij.junit5.JUnit5IdeaTestRunner.startRunnerWithArgs(JUnit5IdeaTestRunner.java:57), com.intellij.rt.junit.IdeaTestRunner$Repeater$1.execute(IdeaTestRunner.java:38), com.intellij.rt.execution.junit.TestsRepeater.repeat(TestsRepeater.java:11), com.intellij.rt.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:35), com.intellij.rt.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:232), com.intellij.rt.junit.JUnitStarter.main(JUnitStarter.java:55)]",
  "errorMessage" : "Cannot invoke \"jakarta.servlet.ServletInputStream.readAllBytes()\" because the return value of \"jakarta.servlet.http.HttpServletRequest.getInputStream()\" is null"
}

java.lang.NullPointerException: Cannot invoke "jakarta.servlet.ServletInputStream.readAllBytes()" because the return value of "jakarta.servlet.http.HttpServletRequest.getInputStream()" is null

	at com.sb.fedssimplification.utilitymodules.loggingutility.model.request.CachedBodyHttpServletRequestWrapper.<init>(CachedBodyHttpServletRequestWrapper.java:15)
	at com.sb.fedssimplification.utilitymodules.loggingutility.filter.RequestLogFilter.doFilter(RequestLogFilter.java:48)
	at com.sb.fedssimplification.utilitymodules.secretsmanager.filter.RequestLogFilterTest.testDoFilter_Success(RequestLogFilterTest.java:62)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1596)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1596)
-------------------------------
@Test
void testDoFilter_Success() throws Exception {
    when(httpServletRequest.getMethod()).thenReturn("POST");
    when(httpServletRequest.getRequestURI()).thenReturn("/test");
    when(httpServletRequest.getHeader("Content-Length")).thenReturn("100");
    when(httpServletRequest.getHeader("Host")).thenReturn("localhost");
    when(httpServletRequest.getContentType()).thenReturn("application/json");
    when(httpServletRequest.getHeader("User-Agent")).thenReturn("JUnit-Test");
    when(httpServletRequest.getHeader("Accept")).thenReturn("application/json");
    when(httpServletRequest.getHeader("X-Forwarded-For")).thenReturn("192.168.1.1");

    // Mock InputStream with dummy JSON data
    String requestBody = "{\"key\":\"value\"}";
    ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(requestBody.getBytes());
    
    ServletInputStream servletInputStream = new ServletInputStream() {
        @Override
        public boolean isFinished() {
            return byteArrayInputStream.available() == 0;
        }

        @Override
        public boolean isReady() {
            return true;
        }

        @Override
        public void setReadListener(ReadListener listener) {
            throw new UnsupportedOperationException();
        }

        @Override
        public int read() throws IOException {
            return byteArrayInputStream.read();
        }
    };

    when(httpServletRequest.getInputStream()).thenReturn(servletInputStream);

    requestLogFilter.doFilter(httpServletRequest, servletResponse, filterChain);

    verify(filterChain, times(1)).doFilter(Mockito.any(), Mockito.eq(servletResponse));
}

13:54:52.671 [main] ERROR com.sb.fedssimplification.utilitymodules.loggingutility.logprocessor.LogProcessorFactory -- Error Log: {
  "baseLogDetails" : null,
  "errorCode" : 500,
  "stackTrace" : "[com.sb.fedssimplification.utilitymodules.loggingutility.model.request.CachedBodyHttpServletRequestWrapper.<init>(CachedBodyHttpServletRequestWrapper.java:15), com.sb.fedssimplification.utilitymodules.loggingutility.filter.RequestLogFilter.doFilter(RequestLogFilter.java:48), com.sb.fedssimplification.utilitymodules.secretsmanager.filter.RequestLogFilterTest.testDoFilter_ExceptionHandling(RequestLogFilterTest.java:102), java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103), java.base/java.lang.reflect.Method.invoke(Method.java:580), org.junit.platform.commons.util.ReflectionUtils.invokeMethod(ReflectionUtils.java:728), org.junit.jupiter.engine.execution.MethodInvocation.proceed(MethodInvocation.java:60), org.junit.jupiter.engine.execution.InvocationInterceptorChain$ValidatingInvocation.proceed(InvocationInterceptorChain.java:131), org.junit.jupiter.engine.extension.TimeoutExtension.intercept(TimeoutExtension.java:156), org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestableMethod(TimeoutExtension.java:147), org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestMethod(TimeoutExtension.java:86), org.junit.jupiter.engine.execution.InterceptingExecutableInvoker$ReflectiveInterceptorCall.lambda$ofVoidMethod$0(InterceptingExecutableInvoker.java:103), org.junit.jupiter.engine.execution.InterceptingExecutableInvoker.lambda$invoke$0(InterceptingExecutableInvoker.java:93), org.junit.jupiter.engine.execution.InvocationInterceptorChain$InterceptedInvocation.proceed(InvocationInterceptorChain.java:106), org.junit.jupiter.engine.execution.InvocationInterceptorChain.proceed(InvocationInterceptorChain.java:64), org.junit.jupiter.engine.execution.InvocationInterceptorChain.chainAndInvoke(InvocationInterceptorChain.java:45), org.junit.jupiter.engine.execution.InvocationInterceptorChain.invoke(InvocationInterceptorChain.java:37), org.junit.jupiter.engine.execution.InterceptingExecutableInvoker.invoke(InterceptingExecutableInvoker.java:92), org.junit.jupiter.engine.execution.InterceptingExecutableInvoker.invoke(InterceptingExecutableInvoker.java:86), org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.lambda$invokeTestMethod$7(TestMethodTestDescriptor.java:217), org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73), org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.invokeTestMethod(TestMethodTestDescriptor.java:213), org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:138), org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:68), org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:151), org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73), org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141), org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137), org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139), org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73), org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138), org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95), java.base/java.util.ArrayList.forEach(ArrayList.java:1596), org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41), org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155), org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73), org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141), org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137), org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139), org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73), org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138), org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95), java.base/java.util.ArrayList.forEach(ArrayList.java:1596), org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41), org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155), org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73), org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141), org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137), org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139), org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73), org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138), org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95), org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.submit(SameThreadHierarchicalTestExecutorService.java:35), org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor.execute(HierarchicalTestExecutor.java:57), org.junit.platform.engine.support.hierarchical.HierarchicalTestEngine.execute(HierarchicalTestEngine.java:54), org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:198), org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:169), org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:93), org.junit.platform.launcher.core.EngineExecutionOrchestrator.lambda$execute$0(EngineExecutionOrchestrator.java:58), org.junit.platform.launcher.core.EngineExecutionOrchestrator.withInterceptedStreams(EngineExecutionOrchestrator.java:141), org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:57), org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:103), org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:85), org.junit.platform.launcher.core.DelegatingLauncher.execute(DelegatingLauncher.java:47), org.junit.platform.launcher.core.SessionPerRequestLauncher.execute(SessionPerRequestLauncher.java:63), com.intellij.junit5.JUnit5IdeaTestRunner.startRunnerWithArgs(JUnit5IdeaTestRunner.java:57), com.intellij.rt.junit.IdeaTestRunner$Repeater$1.execute(IdeaTestRunner.java:38), com.intellij.rt.execution.junit.TestsRepeater.repeat(TestsRepeater.java:11), com.intellij.rt.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:35), com.intellij.rt.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:232), com.intellij.rt.junit.JUnitStarter.main(JUnitStarter.java:55)]",
  "errorMessage" : "Cannot invoke \"jakarta.servlet.ServletInputStream.readAllBytes()\" because the return value of \"jakarta.servlet.http.HttpServletRequest.getInputStream()\" is null"
}

java.lang.NullPointerException: Cannot invoke "jakarta.servlet.ServletInputStream.readAllBytes()" because the return value of "jakarta.servlet.http.HttpServletRequest.getInputStream()" is null

	at com.sb.fedssimplification.utilitymodules.loggingutility.model.request.CachedBodyHttpServletRequestWrapper.<init>(CachedBodyHttpServletRequestWrapper.java:15)
	at com.sb.fedssimplification.utilitymodules.loggingutility.filter.RequestLogFilter.doFilter(RequestLogFilter.java:48)
	at com.sb.fedssimplification.utilitymodules.secretsmanager.filter.RequestLogFilterTest.testDoFilter_ExceptionHandling(RequestLogFilterTest.java:102)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1596)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1596)

