import static org.mockito.Mockito.*;
import static org.junit.jupiter.api.Assertions.*;

import jakarta.servlet.http.HttpServletRequest;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.mockito.Mock;
import org.mockito.MockitoAnnotations;

import java.util.*;

class HttpRequestLoggingHelperTest {

    @Mock
    private HttpServletRequest mockRequest;

    private Map<String, String> mapData;

    @BeforeEach
    void setUp() {
        MockitoAnnotations.openMocks(this);
        mapData = new HashMap<>();
        mapData.put("applicationName", "TestApp");
        mapData.put("environment", "TestEnv");
    }

    @Test
    void testBuildRequestLog_ValidRequest() {
        // Mock request data
        when(mockRequest.getMethod()).thenReturn("POST");
        when(mockRequest.getRequestURI()).thenReturn("/test");
        when(mockRequest.getHeaderNames()).thenReturn(Collections.enumeration(Arrays.asList("User-Agent", "Accept")));
        when(mockRequest.getHeader("User-Agent")).thenReturn("Mozilla/5.0");
        when(mockRequest.getHeader("Accept")).thenReturn("application/json");

        // Act
        assertDoesNotThrow(() -> HttpRequestLoggingHelper.buildRequestLog(mockRequest, mapData));

        // Verify interactions
        verify(mockRequest, times(1)).getMethod();
        verify(mockRequest, times(1)).getRequestURI();
        verify(mockRequest, times(1)).getHeaderNames();
        verify(mockRequest, times(1)).getHeader("User-Agent");
        verify(mockRequest, times(1)).getHeader("Accept");
    }

    @Test
    void testBuildRequestLog_NullRequest_LogsWarning() {
        assertDoesNotThrow(() -> HttpRequestLoggingHelper.buildRequestLog(null, mapData));
    }

    @Test
    void testGetBaseMessageInfo_ReturnsValidBaseLogDetails() {
        // Arrange
        Map<String, String> headers = new HashMap<>();
        headers.put("application-name", "TestApp");

        // Act
        var baseLogDetails = HttpRequestLoggingHelper.getBaseMessageInfo(headers);

        // Assert
        assertNotNull(baseLogDetails);
        assertEquals("TestApp", baseLogDetails.getApplicationName());
    }
}
