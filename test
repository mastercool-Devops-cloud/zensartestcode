import jakarta.servlet.ReadListener;
import jakarta.servlet.ServletInputStream;

import java.io.ByteArrayInputStream;
import java.io.IOException;

public class MockServletInputStream extends ServletInputStream {
    private final ByteArrayInputStream inputStream;

    public MockServletInputStream(String body) {
        this.inputStream = new ByteArrayInputStream(body.getBytes());
    }

    @Override
    public boolean isFinished() {
        return inputStream.available() == 0;
    }

    @Override
    public boolean isReady() {
        return true;
    }

    @Override
    public void setReadListener(ReadListener readListener) {
        // Not implemented
    }

    @Override
    public int read() throws IOException {
        return inputStream.read();
    }
}
-----------------------------------
import jakarta.servlet.ReadListener;
import jakarta.servlet.ServletInputStream;
import jakarta.servlet.http.HttpServletRequest;
import org.junit.jupiter.api.Test;
import org.mockito.Mockito;

import java.io.ByteArrayInputStream;
import java.io.IOException;
import java.util.Collections;
import java.util.Enumeration;
import java.util.Map;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.mockito.Mockito.*;

class RequestWrapperTest {

    @Test
    void testRequestWrapperWithHeadersAndBody() throws IOException {
        // Mock HttpServletRequest
        HttpServletRequest mockRequest = Mockito.mock(HttpServletRequest.class);

        // Setup request attributes
        when(mockRequest.getMethod()).thenReturn("POST");
        when(mockRequest.getRequestURI()).thenReturn("/api/resource");
        when(mockRequest.getQueryString()).thenReturn("id=123");

        // Mock headers
        Enumeration<String> headerNames = Collections.enumeration(Collections.singletonList("Content-Type"));
        when(mockRequest.getHeaderNames()).thenReturn(headerNames);
        when(mockRequest.getHeader("Content-Type")).thenReturn("application/json");

        // Mock body
        String requestBody = "{\"name\":\"John\",\"age\":30}";
        when(mockRequest.getInputStream()).thenReturn(new MockServletInputStream(requestBody));

        // Create RequestWrapper instance
        RequestWrapper requestWrapper = new RequestWrapper(mockRequest);

        // Assertions
        assertEquals("POST", requestWrapper.getMethod());
        assertEquals("/api/resource", requestWrapper.getUri());
        assertEquals("id=123", requestWrapper.getQuery());
        assertEquals(Map.of("Content-Type", "application/json"), requestWrapper.getHeaders());
        assertEquals(requestBody, requestWrapper.getBody());
    }

    @Test
    void testRequestWrapperWithEmptyBody() throws IOException {
        // Mock HttpServletRequest
        HttpServletRequest mockRequest = Mockito.mock(HttpServletRequest.class);

        // Setup request attributes
        when(mockRequest.getMethod()).thenReturn("GET");
        when(mockRequest.getRequestURI()).thenReturn("/api/resource");
        when(mockRequest.getQueryString()).thenReturn("id=123");

        // Mock headers
        Enumeration<String> headerNames = Collections.enumeration(Collections.singletonList("Accept"));
        when(mockRequest.getHeaderNames()).thenReturn(headerNames);
        when(mockRequest.getHeader("Accept")).thenReturn("application/json");

        // Empty body
        when(mockRequest.getInputStream()).thenReturn(new MockServletInputStream(""));

        // Create RequestWrapper instance
        RequestWrapper requestWrapper = new RequestWrapper(mockRequest);

        // Assertions
        assertEquals("GET", requestWrapper.getMethod());
        assertEquals("/api/resource", requestWrapper.getUri());
        assertEquals("id=123", requestWrapper.getQuery());
        assertEquals(Map.of("Accept", "application/json"), requestWrapper.getHeaders());
        assertEquals("", requestWrapper.getBody());
    }
}
