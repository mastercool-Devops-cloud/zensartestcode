SELECT DBMS_METADATA.GET_DDL('TABLE', ?) FROM DUAL

import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.stereotype.Repository;

import java.util.List;
import java.util.stream.Collectors;

@Repository
public class SchemaExporterRepository {
    private final JdbcTemplate jdbcTemplate;

    public SchemaExporterRepository(JdbcTemplate jdbcTemplate) {
        this.jdbcTemplate = jdbcTemplate;
    }

    // Extract table schema (DDL)
    public String getTableDDL(String schemaName, String tableName) {
        String sql = "SELECT DBMS_METADATA.GET_DDL('TABLE', ?, ?) FROM DUAL";
        return jdbcTemplate.queryForObject(sql, new Object[]{tableName.toUpperCase(), schemaName.toUpperCase()}, String.class);
    }

    // Extract table data (INSERT statements)
    public List<String> getTableData(String schemaName, String tableName) {
        String sql = "SELECT * FROM " + schemaName + "." + tableName;
        return jdbcTemplate.query(sql, (rs, rowNum) -> {
            int columnCount = rs.getMetaData().getColumnCount();
            StringBuilder insertStmt = new StringBuilder("INSERT INTO " + schemaName + "." + tableName + " VALUES (");
            for (int i = 1; i <= columnCount; i++) {
                Object value = rs.getObject(i);
                if (value instanceof String) {
                    insertStmt.append("'").append(value.toString().replace("'", "''")).append("'");
                } else if (value == null) {
                    insertStmt.append("NULL");
                } else {
                    insertStmt.append(value);
                }
                if (i < columnCount) insertStmt.append(", ");
            }
            insertStmt.append(");");
            return insertStmt.toString();
        });
    }
}

